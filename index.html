<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>PickUp4Collection – near-clone UI</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root{
      --teal:#0e766e;       /* близко к emerald-700, но не фирменный */
      --teal-600:#15807a;
      --teal-50:#e6f7f5;
    }
    html,body{height:100%}
  </style>
</head>
<body class="text-slate-900 bg-white">
  <div id="app"></div>

  <!-- React -->
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
  <script type="text/babel">
    const {useEffect,useMemo,useRef,useState} = React;

    /* ---------- tiny icons ---------- */
    const Icon = ({c="w-5 h-5",children}) => (
      <svg className={c} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">{children}</svg>
    );
    const ICClock = () => <Icon><circle cx="12" cy="12" r="9"/><path d="M12 7v5l3 2"/></Icon>;
    const ICPin   = () => <Icon><path d="M20.5 10c0 5.8-8.5 11.5-8.5 11.5S3.5 15.8 3.5 10a8.5 8.5 0 1 1 17 0Z"/><circle cx="12" cy="10" r="3"/></Icon>;
    const ICInfo  = () => <Icon><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></Icon>;
    const ICCheck = () => <Icon><path d="M20 6 9 17"/><path d="M9 17 4 12"/></Icon>;
    const ICSwipe = () => <Icon><rect x="2" y="5" width="20" height="14" rx="7"/><path d="M10 12h6"/><path d="m14 9 3 3-3 3"/></Icon>;

    /* ---------- helpers ---------- */
    const LS_KEY = "pickup_demo_state_v2";
    const usePersistent = (initial) => {
      const [s,setS] = useState(()=>{
        try{const raw=localStorage.getItem(LS_KEY);return raw?{...initial,...JSON.parse(raw)}:initial;}catch{return initial;}
      });
      useEffect(()=>{try{localStorage.setItem(LS_KEY, JSON.stringify(s));}catch{}},[s]);
      return [s,setS];
    };

    const parseHHMM = (t)=>{const m=String(t||"").match(/^\s*(\d{1,2}):(\d{2})\s*$/); if(!m) return null; const h=+m[1],mm=+m[2]; if(h>23||mm>59) return null; return {h,m:mm};};
    const msLeft = (to, now=new Date())=>{
      const p=parseHHMM(to); if(!p) return 0;
      const end=new Date(now); end.setHours(p.h,p.m,0,0);
      const diff=end-now; return diff>0?diff:0;
    };
    const fmt = (ms)=>{const t=Math.max(0,Math.floor(ms/1000)); const m=Math.floor(t/60), s=t%60; return `${String(m).padStart(2,"0")}:${String(s).padStart(2,"0")}`;};
    const useCountdown = (to)=>{const [tick,set]=useState(0); useEffect(()=>{const id=setInterval(()=>set(x=>x+1),1000); return ()=>clearInterval(id);},[]); return useMemo(()=>fmt(msLeft(to,new Date())),[tick,to]);};

    /* ---------- swipe control (устойчивый) ---------- */
    function SwipeBar({onConfirm,label="Swipe to confirm"}){
      const trackRef=useRef(null), knobRef=useRef(null);
      const [x,setX]=useState(0), [ok,setOk]=useState(false);
      const metrics=useRef({max:0});

      useEffect(()=>{
        const track=trackRef.current, knob=knobRef.current;
        if(!track||!knob) return;

        const onMove=(e)=>{
          const clientX = e.touches ? e.touches[0].clientX : e.clientX;
          const rect=track.getBoundingClientRect();
          const max = rect.width - knob.offsetWidth - 8; // safety
          metrics.current.max=max;
          const nx = Math.min(max, Math.max(0, clientX-rect.left-knob.offsetWidth/2));
          setX(nx);
          if(e.cancelable) e.preventDefault();
        };
        const onEnd=()=>{
          const {max}=metrics.current;
          if(x>=max*0.92){ setOk(true); onConfirm && onConfirm(); }
          else setX(0);
          window.removeEventListener('mousemove',onMove);
          window.removeEventListener('mouseup',onEnd);
          window.removeEventListener('touchmove',onMove);
          window.removeEventListener('touchend',onEnd);
        };
        const start=(e)=>{
          const rect=track.getBoundingClientRect();
          metrics.current.max = rect.width - knob.offsetWidth - 8;
          window.addEventListener('mousemove',onMove);
          window.addEventListener('mouseup',onEnd);
          window.addEventListener('touchmove',onMove,{passive:false});
          window.addEventListener('touchend',onEnd);
          if(e.cancelable) e.preventDefault();
        };

        const el=knob;
        el.addEventListener('mousedown',start);
        el.addEventListener('touchstart',start,{passive:false});
        return ()=>{ el.removeEventListener('mousedown',start); el.removeEventListener('touchstart',start);
          window.removeEventListener('mousemove',onMove); window.removeEventListener('mouseup',onEnd);
          window.removeEventListener('touchmove',onMove); window.removeEventListener('touchend',onEnd);
        };
      },[x,onConfirm]);

      return (
        <div className="select-none">
          <div ref={trackRef} className={`relative h-12 rounded-xl border overflow-hidden shadow-sm ${ok?'border-teal-200 bg-[var(--teal-50)]':'border-slate-200 bg-white'}`}>
            <div className="absolute inset-0 flex items-center justify-center text-slate-600 text-sm">{ok?'Confirmed':label}</div>
            <div
              ref={knobRef}
              className={`absolute top-1 left-1 h-10 w-10 rounded-lg flex items-center justify-center shadow-md text-white ${ok?'bg-[var(--teal)]':'bg-slate-900'}`}
              style={{transform: ok? 'translateX(calc(100% - 3rem))' : `translateX(${x}px)`}}
              role="slider" tabIndex="0" aria-valuemin={0} aria-valuemax={100} aria-valuenow={0}
            >
              <ICSwipe/>
            </div>
          </div>
        </div>
      );
    }

    /* ---------- order screen ---------- */
    function OrderScreen({details,onCollect}){
      const tel = details.phone.replace(/\s+/g,'');
      return (
        <div className="min-h-screen flex flex-col">
          {/* top bar */}
          <header className="bg-[var(--teal)] text-white">
            <div className="max-w-md mx-auto px-4 py-3 font-semibold">Your order</div>
          </header>

          <main className="flex-1">
            <div className="max-w-md mx-auto p-4">
              {/* status card */}
              <div className="rounded-2xl border border-slate-200 bg-white shadow-sm overflow-hidden">
                <div className="p-4">
                  <div className="text-xs font-medium text-[var(--teal)]/80">Order status</div>
                  <div className="mt-1 text-slate-700 flex items-center gap-2 text-sm">
                    <span className="inline-flex items-center gap-1"><ICClock/><span>Pending collection</span></span>
                  </div>
                  <div className="mt-3">
                    <span className="inline-block rounded-md bg-[var(--teal-50)] text-[var(--teal)] px-3 py-1 text-sm tracking-widest font-semibold">{details.orderCode}</span>
                  </div>
                </div>
                <hr className="border-slate-100"/>
                <div className="p-4 space-y-3 text-sm">
                  <div className="flex items-center justify-between">
                    <div className="font-medium">{details.bagName}</div>
                    <div className="text-slate-600">x{details.quantity} • {details.price}</div>
                  </div>

                  <div className="flex items-start gap-3 text-slate-700">
                    <ICPin/><div>
                      <div className="font-medium">{details.storeName}</div>
                      <div className="text-slate-600">{details.address}</div>
                    </div>
                  </div>

                  <div className="flex items-center gap-3 text-slate-700">
                    <ICClock/><div>Pick-up today between <span className="font-medium">{details.pickupFrom}</span> and <span className="font-medium">{details.pickupTo}</span></div>
                  </div>

                  <div className="flex items-start gap-3 text-slate-700">
                    <ICInfo/><div>{details.notes}</div>
                  </div>
                </div>

                <div className="p-4 pt-0">
                  <a href={`tel:${tel}`} className="w-full inline-flex items-center justify-center rounded-xl border border-slate-200 py-2 text-sm">Call store</a>
                </div>
              </div>

              <div className="py-4 text-center text-xs text-slate-500">Demo UI • No brand</div>
            </div>
          </main>

          {/* fixed bottom CTA */}
          <div className="sticky bottom-0 left-0 right-0 bg-white/90 backdrop-blur border-t border-slate-200">
            <div className="max-w-md mx-auto p-3">
              <button onClick={onCollect} className="w-full py-3 rounded-xl font-semibold text-white bg-[var(--teal)] active:bg-[var(--teal-600)]">TAP TO COLLECT</button>
            </div>
          </div>
        </div>
      );
    }

    /* ---------- bottom sheet (collect) ---------- */
    function CollectSheet({details,onClose}){
      const [done,setDone] = useState(false);
      const timeLeft = useCountdown(details.pickupTo);

      return (
        <div className="fixed inset-0 z-50">
          <div className="absolute inset-0 bg-black/40" onClick={onClose}></div>
          <div className="absolute inset-x-0 bottom-0">
            <div className="mx-auto max-w-md rounded-t-3xl bg-white shadow-2xl border border-slate-200">
              <div className="p-4 border-b border-slate-100 flex items-center justify-between">
                <div className="font-semibold">Order to collect</div>
                <button className="text-slate-400" onClick={onClose} aria-label="Close">✕</button>
              </div>

              <div className="p-4 space-y-4">
                <div className="text-center">
                  <div className="text-xs text-slate-500">Qty</div>
                  <div className="mt-1 inline-flex items-center justify-center w-10 h-10 rounded-full bg-[var(--teal-50)] text-[var(--teal)] font-semibold">1x</div>
                  <div className="mt-2 font-medium">{details.bagName}</div>
                  <div className="mt-2">
                    <span className="inline-block rounded-md bg-[var(--teal-50)] text-[var(--teal)] px-3 py-1 text-sm tracking-widest font-semibold">{details.orderCode}</span>
                  </div>
                </div>

                <div className="flex items-center justify-center">
                  <div className={`w-14 h-14 rounded-full flex items-center justify-center ${done?'bg-[var(--teal)] text-white':'bg-[var(--teal-50)] text-[var(--teal)]'} border border-[color:var(--teal)]/20`}>
                    {done ? <ICCheck/> : <ICClock/>}
                  </div>
                </div>

                <div className="text-center text-xs text-slate-600">
                  {done ? 'Pick-up confirmed' : 'Show this screen to staff when collecting'}
                </div>

                {done ? (
                  <div className="text-center text-xs text-slate-500">Window ends in: {timeLeft}</div>
                ) : null}

                {!done ? (
                  <div className="pt-2">
                    <SwipeBar label="Swipe to confirm" onConfirm={()=>setDone(true)}/>
                    <div className="mt-2 text-center text-xs text-slate-500">Drag the handle all the way to the right.</div>
                  </div>
                ) : (
                  <button onClick={onClose} className="w-full py-3 rounded-xl border border-slate-200 text-sm">Close</button>
                )}
              </div>
            </div>
          </div>
        </div>
      );
    }

    /* ---------- app ---------- */
    const defaults = {
      storeName:"Del Rio Produce Market",
      address:"2214 Clement St, San Francisco, CA",
      phone:"+1 415 555 0199",
      pickupFrom:"11:00", pickupTo:"13:00",
      orderCode:"DK1H",
      bagName:"Surprise Bag",
      quantity:1, price:"$4.99",
      notes:"Please bring your own bag."
    };

    function App(){
      const [state,setState] = usePersistent({details:defaults});
      const [sheet,setSheet] = useState(false);
      return (
        <>
          <OrderScreen details={state.details} onCollect={()=>setSheet(true)}/>
          {sheet && <CollectSheet details={state.details} onClose={()=>setSheet(false)}/>}
        </>
      );
    }

    ReactDOM.createRoot(document.getElementById('app')).render(<App/>);
  </script>
</body>
</html>
